diff -ruN linux-4.9.37_original/net/ipv6/output_core.c linux-4.9.37_modified/net/ipv6/output_core.c
--- linux-4.9.37_original/net/ipv6/output_core.c	2017-07-12 16:42:41.000000000 +0300
+++ linux-4.9.37_modified/net/ipv6/output_core.c	2018-07-04 07:50:03.119724818 +0300
@@ -86,6 +86,7 @@
 
 	while (offset <= packet_len) {
 		struct ipv6_opt_hdr *exthdr;
+		unsigned int len;
 
 		switch (**nexthdr) {
 
@@ -111,7 +112,10 @@
 
 		exthdr = (struct ipv6_opt_hdr *)(skb_network_header(skb) +
 						 offset);
-		offset += ipv6_optlen(exthdr);
+		len = ipv6_optlen(exthdr);
+		if (len + offset >= IPV6_MAXPLEN)
+			return -EINVAL;
+		offset += len;
 		if (offset > IPV6_MAXPLEN)
 			return -EINVAL;
 		*nexthdr = &exthdr->nexthdr;
